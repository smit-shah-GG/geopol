---
phase: 05-tkg-training
plan: 04
type: execute
---

<objective>
Set up periodic retraining schedule for continuous learning.

Purpose: Implement automated weekly/monthly retraining to keep the TKG model current with evolving world events.
Output: Retraining scheduler that updates the model on a predictable schedule with fresh GDELT data.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
@~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-tkg-training/05-CONTEXT.md
@.planning/phases/05-tkg-training/05-RESEARCH.md
@.planning/phases/05-tkg-training/05-01-SUMMARY.md
@.planning/phases/05-tkg-training/05-02-SUMMARY.md
@.planning/phases/05-tkg-training/05-03-SUMMARY.md
@scripts/train_tkg.py
@src/training/data_collector.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create retraining scheduler</name>
  <files>src/training/scheduler.py, config/retraining.yaml</files>
  <action>
  Implement periodic retraining system as specified in CONTEXT.md (time-based, not performance-triggered):

  Scheduler class:
  - RetrainingScheduler with configurable frequency (weekly/monthly)
  - should_retrain(): Check if retraining is due based on last training timestamp
  - retrain(): Orchestrate full retraining pipeline
  - get_next_retrain_time(): Show when next retraining will occur

  Config file (YAML):
  - frequency: "weekly" or "monthly"
  - day_of_week: 0 (Sunday) for weekly
  - day_of_month: 1 for monthly
  - hour: 2 (2 AM)
  - data_window: 30 (days of data to use)
  - backup_count: 3 (keep last 3 models)

  The scheduler should:
  - Track last training time in models/tkg/last_trained.json
  - Backup existing model before retraining
  - Collect fresh GDELT data
  - Train new model
  - Validate new model performs better than baseline
  - Replace production model if validation passes
  </action>
  <verify>python -c "from src.training.scheduler import RetrainingScheduler; s = RetrainingScheduler(); print(f'Next retrain: {s.get_next_retrain_time()}')"</verify>
  <done>Retraining scheduler implemented</done>
</task>

<task type="auto">
  <name>Task 2: Create retraining script</name>
  <files>scripts/retrain_tkg.py, scripts/schedule_retraining.sh</files>
  <action>
  Create automated retraining script:

  Python script (retrain_tkg.py):
  - Use RetrainingScheduler to check if retraining needed
  - If yes: collect fresh 30-day window of GDELT data
  - Train new model with same hyperparameters
  - Compare performance to current model
  - Replace if better, keep if not
  - Log all metrics and decisions

  Shell wrapper (schedule_retraining.sh):
  - Simple script to be called by cron/systemd timer
  - Activates environment, runs Python script
  - Logs output to logs/retraining/

  Include dry-run mode for testing without actual training.
  </action>
  <verify>python scripts/retrain_tkg.py --dry-run</verify>
  <done>Retraining scripts created</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete TKG training system with periodic retraining</what-built>
  <how-to-verify>
    1. Check training completed: ls -la models/tkg/regcn_trained.pt
    2. Test prediction: python -c "from src.forecasting.tkg_predictor import TKGPredictor; p = TKGPredictor(); print('Predictor ready')"
    3. Run forecast with TKG: python forecast.py "Will there be conflict in Ukraine?" --verbose
    4. Verify TKG contribution: Look for "TKG prediction" in output (not just placeholder)
    5. Check scheduler: python scripts/retrain_tkg.py --dry-run --check-schedule
  </how-to-verify>
  <resume-signal>Type "approved" if TKG predictions are working, or describe issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Scheduler can determine retraining schedule
- [ ] Retraining script runs in dry-run mode
- [ ] Configuration file exists and is valid
- [ ] Shell wrapper is executable
- [ ] TKG contributes real predictions to ensemble
</verification>

<success_criteria>
- All tasks completed
- Periodic retraining configured
- Scripts ready for cron/systemd
- TKG predictor produces real predictions
- Phase 5 complete
</success_criteria>

<output>
After completion, create `.planning/phases/05-tkg-training/05-04-SUMMARY.md`:

# Phase 5 Plan 4: Periodic Retraining Summary

**Set up automated retraining schedule for continuous learning**

## Accomplishments

- RetrainingScheduler with configurable frequency
- Automated retraining pipeline
- Model versioning and backup
- Production-ready scripts

## Files Created/Modified

- `src/training/scheduler.py` - Retraining scheduler
- `config/retraining.yaml` - Schedule configuration
- `scripts/retrain_tkg.py` - Retraining automation
- `scripts/schedule_retraining.sh` - Cron wrapper

## Configuration

- Schedule: [weekly/monthly]
- Next retrain: [date/time]
- Data window: 30 days

## Next Step

Phase 5 complete! TKG predictor now trained and contributing meaningful predictions.
</output>