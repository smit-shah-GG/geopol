---
phase: 05-tkg-training
plan: 03
type: execute
---

<objective>
Train the RE-GCN model on GDELT data with visible progress monitoring.

Purpose: Execute the training pipeline to create a working TKG predictor that contributes meaningful predictions to the ensemble.
Output: Trained RE-GCN model saved to disk, integrated with TKGPredictor, showing training metrics.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-phase.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-tkg-training/05-CONTEXT.md
@.planning/phases/05-tkg-training/05-RESEARCH.md
@.planning/phases/05-tkg-training/05-01-SUMMARY.md
@.planning/phases/05-tkg-training/05-02-SUMMARY.md
@src/forecasting/tkg_predictor.py
@src/training/models/regcn_cpu.py
@src/training/train_utils.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create training script with progress monitoring</name>
  <files>scripts/train_tkg.py, src/training/progress_monitor.py</files>
  <action>
  Create main training script with visible progress monitoring as specified in CONTEXT.md:

  Progress monitor should show:
  - Epoch progress with loss values
  - MRR (Mean Reciprocal Rank) on validation set
  - Number of active entities and relations
  - Graph density metrics
  - Patterns being learned (top predicted relations)

  Training script:
  - Load processed GDELT data from events.parquet
  - Create train/val split (80/20 by time)
  - Initialize RE-GCN model with proper dimensions
  - Train for 100 epochs with Adam optimizer (lr=0.001)
  - Save checkpoints every 10 epochs
  - Display progress every epoch
  - Final model saved to models/tkg/regcn_trained.pt

  Include basic tensorboard logging for loss curves if time permits.
  </action>
  <verify>python scripts/train_tkg.py --dry-run # Should initialize without training</verify>
  <done>Training script created with progress monitoring</done>
</task>

<task type="auto">
  <name>Task 2: Execute training and save model</name>
  <files>models/tkg/regcn_trained.pt, logs/training/tkg_metrics.json</files>
  <action>
  Run the training script to actually train the model:

  - Execute: python scripts/train_tkg.py
  - Training will take approximately 10-20 minutes for 100 epochs on CPU
  - Monitor output to ensure loss is decreasing
  - Check that MRR is improving (target >0.2 for meaningful contribution)
  - Save training metrics to JSON for analysis
  - Create final checkpoint at models/tkg/regcn_trained.pt

  If training is too slow, reduce to 50 epochs initially. The key is getting a trained model that beats the frequency baseline.
  </action>
  <verify>ls -la models/tkg/regcn_trained.pt && python -c "import torch; state = torch.load('models/tkg/regcn_trained.pt', weights_only=True); print(f'Model trained for {state.get(\"epoch\", 0)} epochs')"</verify>
  <done>Model trained and saved successfully</done>
</task>

<task type="auto">
  <name>Task 3: Integrate trained model with TKGPredictor</name>
  <files>src/forecasting/tkg_predictor.py, tests/test_tkg_integration.py</files>
  <action>
  Update TKGPredictor to load and use the trained model:

  In TKGPredictor.__init__():
  - Check if models/tkg/regcn_trained.pt exists
  - If yes, load the trained model automatically
  - Set self.trained = True

  Add method load_pretrained():
  - Load saved model state
  - Initialize model with saved weights
  - Set proper device (CPU)

  Create integration test:
  - Load sample graph
  - Make predictions with trained model
  - Verify predictions are different from baseline
  - Check confidence scores are reasonable (0.1-0.9)

  This ensures the 40% TKG weight in the ensemble actually contributes meaningful predictions.
  </action>
  <verify>python -m pytest tests/test_tkg_integration.py -v</verify>
  <done>Trained model integrated with TKGPredictor</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] Training script runs without errors
- [ ] Model checkpoint exists at models/tkg/regcn_trained.pt
- [ ] Training metrics show improvement (MRR > 0.2)
- [ ] Integration test passes
- [ ] TKGPredictor loads trained model automatically
</verification>

<success_criteria>
- All tasks completed
- Model trained for at least 50 epochs
- MRR shows meaningful performance
- Integration with ensemble complete
- TKG predictions contribute to forecasts
</success_criteria>

<output>
After completion, create `.planning/phases/05-tkg-training/05-03-SUMMARY.md`:

# Phase 5 Plan 3: Training Pipeline Summary

**Trained RE-GCN model on GDELT data with visible progress**

## Accomplishments

- Training script with progress monitoring
- Model trained for [X] epochs
- MRR achieved: [value]
- Integration with TKGPredictor complete

## Files Created/Modified

- `scripts/train_tkg.py` - Main training script
- `src/training/progress_monitor.py` - Progress tracking
- `models/tkg/regcn_trained.pt` - Trained model
- `tests/test_tkg_integration.py` - Integration test

## Training Metrics

- Final loss: [value]
- Validation MRR: [value]
- Training time: [duration]

## Next Step

Ready for 05-04-PLAN.md (Periodic retraining)
</output>