---
phase: 03-hybrid-forecasting
plan: 03
type: execute
---

<objective>
Integrate TKG prediction algorithms (RE-GCN) for graph-based forecasting.

Purpose: Add temporal knowledge graph extrapolation capabilities using established algorithms.
Output: Working RE-GCN integration that produces graph-based predictions to complement LLM scenarios.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-hybrid-forecasting/03-RESEARCH.md
@.planning/phases/03-hybrid-forecasting/03-01-SUMMARY.md
@.planning/phases/03-hybrid-forecasting/03-02-SUMMARY.md
@.planning/phases/02-knowledge-graph-engine/02-01-SUMMARY.md
@.planning/phases/02-knowledge-graph-engine/02-02-SUMMARY.md
@src/knowledge_graph/temporal_graph_builder.py
@src/knowledge_graph/embeddings.py
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate RE-GCN repository and adapt data format</name>
  <files>src/forecasting/tkg_models/regcn_wrapper.py, src/forecasting/tkg_models/data_adapter.py, requirements.txt</files>
  <action>Clone RE-GCN repository (https://github.com/Lee-zix/RE-GCN) as git submodule in src/forecasting/tkg_models/. Create REGCNWrapper class that interfaces with the model. Implement DataAdapter to convert our NetworkX temporal graph to RE-GCN's expected format: (subject, relation, object, timestamp) quadruples. Map our entity IDs to consecutive integers, relation types to relation IDs. Handle timestamp conversion to RE-GCN's discrete time steps. Use our existing RotatE embeddings as initialization if dimension matches, otherwise use random init. Add torch>=2.0, numpy>=1.20 to requirements.txt.</action>
  <verify>python -c "from src.forecasting.tkg_models.regcn_wrapper import REGCNWrapper; model = REGCNWrapper(); print('RE-GCN wrapper initialized')" runs without error</verify>
  <done>RE-GCN model integrated with data format adapter for our graph structure</done>
</task>

<task type="auto">
  <name>Task 2: Implement TKG prediction interface</name>
  <files>src/forecasting/tkg_predictor.py, tests/test_tkg_predictor.py</files>
  <action>Create TKGPredictor class with predict_future_events() method. Load pre-trained RE-GCN model or train on recent history (last 30 days of events). Implement extrapolation for next timestep: given query (entity1, ?, entity2) predict relation type, or (entity1, relation, ?) predict target entity. Return top-k predictions with confidence scores based on model's ranking scores. Add temporal decay weighting for older events. Create test with small synthetic graph to verify predictions are sensible (e.g., diplomatic events more likely after cooperation than conflict).</action>
  <verify>python -m pytest tests/test_tkg_predictor.py -v passes all tests</verify>
  <done>TKGPredictor generates future event predictions from graph patterns</done>
</task>

<task type="auto">
  <name>Task 3: Create graph validation feedback for LLM scenarios</name>
  <files>src/forecasting/graph_validator.py, src/forecasting/reasoning_orchestrator.py</files>
  <action>Implement GraphValidator that takes LLM-generated scenarios and validates against TKG predictions. For each scenario event, query TKGPredictor for likelihood. Calculate precedent score: how well scenario aligns with graph-predicted patterns. Generate structured feedback: "Event X unlikely based on pattern Y (confidence: 0.2)". Integrate validator into ReasoningOrchestrator's validation step, replacing placeholder from Plan 1. Format feedback for scenario refinement prompts. Ensure feedback preserves specific examples from graph for explainability.</action>
  <verify>python -c "from src.forecasting.graph_validator import GraphValidator; validator = GraphValidator(); feedback = validator.validate_scenario({'events': []}); print('Validation feedback generated')" runs successfully</verify>
  <done>Graph validation provides concrete feedback for LLM scenario refinement</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] RE-GCN model loads and processes our graph format
- [ ] TKG predictions align with recent patterns
- [ ] Graph validation influences scenario refinement
- [ ] Test coverage for prediction pipeline
- [ ] No memory leaks in model inference
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- RE-GCN successfully integrated
- TKG predictions generated for future events
- Graph validation feedback incorporated in reasoning
- Bidirectional LLM-graph interaction working
</success_criteria>

<output>
After completion, create `.planning/phases/03-hybrid-forecasting/03-03-SUMMARY.md`:

# Phase 3 Plan 3: TKG Algorithms Summary

**Integrated RE-GCN for temporal graph predictions and validation**

## Accomplishments

- Integrated RE-GCN repository with data adapters
- Implemented TKG prediction interface
- Created graph validation for LLM scenarios
- Established bidirectional LLM-graph feedback loop

## Files Created/Modified

- `src/forecasting/tkg_models/regcn_wrapper.py` - RE-GCN integration
- `src/forecasting/tkg_models/data_adapter.py` - Graph format conversion
- `src/forecasting/tkg_predictor.py` - Prediction interface
- `src/forecasting/graph_validator.py` - Scenario validation
- `src/forecasting/reasoning_orchestrator.py` - Added validation feedback
- `tests/test_tkg_predictor.py` - TKG prediction tests
- `requirements.txt` - Added torch, numpy

## Decisions Made

- Used RE-GCN over TiRGN (more mature implementation)
- CPU-only PyTorch for compatibility (no CUDA required)
- Reuse RotatE embeddings when possible for consistency

## Issues Encountered

[Problems and resolutions, or "None"]

## Next Step

Ready for 03-04-PLAN.md (Ensemble and CLI interface)
</output>